# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- none

pool:
  vmImage: ubuntu-latest

steps:
#- task: AzureCLI@2
#  inputs:
#    azureSubscription: 'Static-Web-Connection' # (Connection set for Ray's Sub)
#    scriptType: bash
#    scriptLocation: inlineScript
#    inlineScript: |
#      az deployment sub create --location eastus --template-file Static-Web-Infrastructure/CDNStaticWebsite.bicep --parameters projectName=$(projectName) environment=$(environment)
- task: AzureResourceManagerTemplateDeployment@3
  inputs:
    deploymentScope: 'Subscription'
    azureResourceManagerConnection: 'Static-Web-Connection'
    subscriptionId: '28e62442-8bc7-4e32-8792-7b6f570861ba'
    location: 'East US'
    templateLocation: 'Linked artifact'
    csmFile: './Static-Web-Infrastructure/CDNStaticWebsite.bicep'
    overrideParameters: -projectName $(projectName) -environment $(environment)
    deploymentMode: 'Incremental'
    deploymentOutputs: 'storageAccName'


# I have added the 3 subscription IDs as parameters to this deployment, you can find / modify their values in the variables tab - Raymond
# Old Command - az deployment sub create --name $(DeploymentName) --location $(Region) --template-file $(templateFile) --parameters gssSubscriptionId=$(gssSubID) hubSubscriptionId=$(hubSubID) landingZoneSubscriptionId=$(lzSubID)
# - task: AzureFileCopy@4
#  inputs: 
#   sourcePath: './*'
#   azureSubscription: 'Static-Web-Connection' # (Connection set for Ray's Sub)
#   destination: azureBlob
#   storage: storage name 
#   containerName: $web
   